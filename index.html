<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Programme Escalade ‚Äî App</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Escalade Trainer">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: #f8fafc;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  text-align: center;
  font-weight: 700;
  font-size: 1.8em;
  margin: 1em 0 0.5em 0;
  color: #a5b4fc;
  letter-spacing: 1px;
}

h2 {
  font-size: 1.2em;
  margin-bottom: 0.4em;
  color: #c7d2fe;
}

.card {
  width: 90%;
  max-width: 500px;
  background: rgba(15, 23, 42, 0.8);
  border: 1px solid rgba(99, 102, 241, 0.2);
  border-radius: 14px;
  margin: 12px 0;
  padding: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(10px);
  animation: fadeIn 0.6s ease;
}

ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

li {
  padding: 8px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

li:last-child {
  border-bottom: none;
}

button {
  padding: 6px 12px;
  margin-left: 8px;
  border-radius: 8px;
  border: none;
  background: linear-gradient(90deg, #6366f1, #8b5cf6);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.15s ease, opacity 0.15s ease;
}

button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

button:active {
  transform: scale(0.95);
}

.reset-btn {
  background: linear-gradient(90deg, #ef4444, #f87171);
  margin-top: 10px;
}

#timer_display {
  font-size: 2em;
  font-weight: bold;
  color: #a5b4fc;
  letter-spacing: 1px;
}

.progress-container {
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  height: 12px;
  width: 100%;
  overflow: hidden;
  margin-top: 6px;
}

.progress-bar {
  height: 12px;
  background: linear-gradient(90deg, #6366f1, #8b5cf6);
  width: 0%;
  transition: width 0.4s ease;
  border-radius: 10px;
}

footer {
  margin-top: auto;
  padding: 12px;
  font-size: 0.9em;
  opacity: 0.6;
}

.day {
  padding: 10px;
  margin: 6px 0;
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  cursor: pointer;
  transition: background 0.3s;
}

.day:hover {
  background: rgba(99,102,241,0.15);
}

.day h3 {
  margin: 0;
  display: flex;
  justify-content: space-between;
  font-weight: 600;
}

.day-details {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transition: all 0.5s cubic-bezier(.25,.8,.25,1);
}

.day-details.open {
  max-height: 300px;
  opacity: 1;
  margin-top: 8px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>
<h1>üèîÔ∏è Programme Escalade & Musculation</h1>

<!-- Calendrier interactif -->
<div class="card">
  <h2>üóìÔ∏è Calendrier</h2>
  <div id="calendar"></div>
</div>

<!-- D√©tail de la s√©ance du jour -->
<div class="card" id="daily_session_card">
  <h2 id="session_title">üí™ S√©ance du jour</h2>
  <ul id="session_list"></ul>
  <button class="reset-btn" onclick="reset()">üîÑ Reset s√©ries</button>
  <button style="margin-top:10px;" onclick="markSessionDone()">‚úÖ S√©ance termin√©e</button>
</div>

<!-- Progression mensuelle et streak -->
<div class="card" id="progress_card">
  <h2>üìà Progression</h2>
  <p>Semaine : <span id="week_progress_text"></span></p>
  <div class="progress-container"><div class="progress-bar" id="week_progress_bar"></div></div>
  <p style="margin-top:8px;">Mois : <span id="month_progress_text"></span></p>
  <div class="progress-container"><div class="progress-bar" id="month_progress_bar"></div></div>
  <p style="margin-top:12px;">üî• Streak : <span id="streak_value">0</span> jours cons√©cutifs</p>
</div>

<!-- Minuteur global -->
<div class="card">
  <h2>‚è±Ô∏è Minuteur global</h2>
  <p><span id="timer_display">00:00</span></p>
  <div>
    <button onclick="startTimer()">‚ñ∂ Start</button>
    <button onclick="stopTimer()">‚è∏ Stop</button>
    <button onclick="resetTimer()" class="reset-btn">üîÅ Reset</button>
  </div>
</div>

<footer>¬© 2025 Escalade Trainer ‚Ä¢ Stay Strong üí•</footer>

<script>
// --- Programme hebdomadaire adapt√© √† toi ---
// 18 ans, 60kg, 1m80, chambre √©tudiante, objectif : masse & force escalade
const programme = {
  Lundi: { title: "Pouss√©e + Core", ex: ["Pompes lest√©es si possible ‚Äî 4√ó10-12", "Planche ‚Äî 4√ó40s", "Dips sur chaise ‚Äî 4√ó12"] },
  Mardi: { title: "Tirage + Grip", ex: ["Tractions australiennes ou sur barre ‚Äî 4√ó6-10", "Suspension sur prises maison ‚Äî 4√ó20s", "Rowing invers√© sous table ‚Äî 4√ó10"] },
  Mercredi: { title: "Jambes + Explosivit√©", ex: ["Squats ‚Äî 4√ó15", "Fentes avant ‚Äî 4√ó12", "Mont√©es de genoux dynamiques ‚Äî 4√ó30s"] },
  Jeudi: { title: "Haut du corps + Doigts", ex: ["Pompes serr√©es ‚Äî 4√ó12", "Suspension 3 doigts ‚Äî 4√ó12s", "Gainage lat√©ral ‚Äî 4√ó40s / c√¥t√©"] },
  Vendredi: { title: "Tirage + Core", ex: ["Tractions australiennes ‚Äî 4√ó10", "Crunchs ‚Äî 4√ó20", "Planche lat√©rale ‚Äî 4√ó40s"] },
  Samedi: { title: "Repos actif", ex: ["√âtirements", "Mobilit√©", "Yoga doux"] },
  Dimanche: { title: "Repos total", ex: ["Hydratation", "Pr√©paration semaine", "Sieste üòå"] }
};

// --- Calendrier interactif ---
const calendar = document.getElementById('calendar');
const todayName = new Date().toLocaleDateString('fr-FR', { weekday: 'long' });
for (const [day, data] of Object.entries(programme)) {
  const d = document.createElement('div');
  d.className = 'day';
  d.innerHTML = `<h3>${day} <span style="font-size:.9em;opacity:.7;">${data.title}</span></h3>
                 <div class="day-details">
                   <ul>${data.ex.map(e=>`<li>${e}</li>`).join('')}</ul>
                 </div>`;
  calendar.appendChild(d);
}

// --- Menu d√©roulant du calendrier ---
const days = document.querySelectorAll('.day');
days.forEach(day=>{
  day.addEventListener('click',()=>{
    const details = day.querySelector('.day-details');
    const open = details.classList.contains('open');
    document.querySelectorAll('.day-details').forEach(d=>d.classList.remove('open'));
    if(!open) details.classList.add('open');
  });
});

// --- S√©ance du jour ---
const sessionList = document.getElementById('session_list');
const title = document.getElementById('session_title');
const todayData = programme[todayName.charAt(0).toUpperCase() + todayName.slice(1)];
if(todayData){
  title.textContent = `üí™ S√©ance du jour (${todayData.title})`;
  todayData.ex.forEach(ex=>{
    const li = document.createElement('li');
    li.textContent = ex;
    sessionList.appendChild(li);
  });
} else {
  title.textContent = "üòå Jour de repos / √©tirements";
  sessionList.innerHTML = "<li>Profite pour r√©cup√©rer et t‚Äô√©tirer !</li>";
}

// --- Progression et streak ---
function markSessionDone(){
  const today = new Date().toISOString().split('T')[0];
  let history = JSON.parse(localStorage.getItem('sessions_done')||'[]');
  if(!history.includes(today)){
    history.push(today);
    localStorage.setItem('sessions_done', JSON.stringify(history));
  }
  updateProgress();
}

function updateProgress(){
  const history = JSON.parse(localStorage.getItem('sessions_done')||'[]');
  const today = new Date();
  
  // Week progress
  const yearWeek = (d=>{
    const oneJan=new Date(d.getFullYear(),0,1);
    const numberOfDays=Math.floor((d-oneJan)/(24*60*60*1000));
    return Math.ceil((numberOfDays + oneJan.getDay()+1)/7);
  })(today);
  
  const weekSessions = history.filter(date=>{
    const d = new Date(date);
    const week = (d=>{
      const oneJan = new Date(d.getFullYear(),0,1);
      const numberOfDays = Math.floor((d-oneJan)/(24*60*60*1000));
      return Math.ceil((numberOfDays + oneJan.getDay()+1)/7);
    })(d);
    return week === yearWeek;
  }).length;
  
  const weekProgress = Math.min((weekSessions/5)*100,100);
  document.getElementById('week_progress_bar').style.width = weekProgress+'%';
  document.getElementById('week_progress_text').textContent = `${weekSessions}/5 s√©ances`;
  
  // Month progress
  const month = today.getMonth();
  const monthSessions = history.filter(date => new Date(date).getMonth() === month).length;
  const monthDays = new Date(today.getFullYear(), month+1,0).getDate();
  const monthProgress = Math.min((monthSessions/(monthDays/2))*100,100);
  document.getElementById('month_progress_bar').style.width = monthProgress+'%';
  document.getElementById('month_progress_text').textContent = `${monthSessions} s√©ances`;
  
  // Streak
  let streak = 0;
  let checkDate = new Date(today);
  while(history.includes(checkDate.toISOString().split('T')[0])){
    streak++;
    checkDate.setDate(checkDate.getDate()-1);
  }
  document.getElementById('streak_value').textContent = streak;
}

updateProgress();

// --- Minuteur global ---
let timerInterval;
let timerSeconds = parseInt(localStorage.getItem('timerSeconds')||'0');
const display = document.getElementById('timer_display');
function updateDisplay(){
  let m=Math.floor(timerSeconds/60), s=timerSeconds%60;
  display.textContent=`${m<10?'0':''}${m}:${s<10?'0':''}${s}`;
}
updateDisplay();
function startTimer(){
  if(timerInterval) return;
  timerInterval=setInterval(()=>{
    timerSeconds++;
    localStorage.setItem('timerSeconds', timerSeconds);
    updateDisplay();
  },1000);
}
function stopTimer(){
  clearInterval(timerInterval);
  timerInterval=null;
}
function resetTimer(){
  timerSeconds=0;
  updateDisplay();
  localStorage.removeItem('timerSeconds');
}

// --- Notifications quotidiennes ---
if ('Notification' in window) {
  Notification.requestPermission();
}

function sendReminder() {
  if (Notification.permission === "granted") {
    new Notification("üí™ Escalade Trainer", {
      body: "Tu n'as pas encore fait ta s√©ance aujourd'hui !",
      icon: "icon-192.png"
    });
  }
}

function scheduleDailyReminder() {
  const now = new Date();
  const reminderTime = new Date();
  reminderTime.setHours(18,0,0,0); // 18h00

  let timeout = reminderTime - now;
  if (timeout < 0) timeout += 24*60*60*1000; // planifier pour demain si l'heure est pass√©e

  setTimeout(()=>{
    const today = new Date().toISOString().split('T')[0];
    let history = JSON.parse(localStorage.getItem('sessions_done')||'[]');
    if(!history.includes(today)) sendReminder();
    scheduleDailyReminder(); // r√©p√®te chaque jour
  }, timeout);
}

scheduleDailyReminder();

</script>
</body>
</html>
